import{v as w,w as N,j as e,l as k,m as y,y as z,o as U,r as f,n as v}from"./index-d2cb6bc4.js";import{u as D}from"./useDetailedOrganisations-c22d272b.js";import{E as S,L as C,I as g}from"./Loading-fff7cd2e.js";import{g as j}from"./formatDates-388d77ab.js";import"./useQuery-c133b67d.js";var x={},E=N;Object.defineProperty(x,"__esModule",{value:!0});var h=x.default=void 0,q=E(w()),L=e,O=(0,q.default)((0,L.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");h=x.default=O;function R(){return k({mutationFn:async({organization_id:n,token:s,user_email:r,role:a})=>{await y.post("/api/organizations/users",{user_email:r,role:a},{headers:{Authorization:s,Organization:n}})}})}function A({user:n,updateUser:s,imOwner:r}){const[a,l]=f.useState(n.role),o=a===n.role;function c(){s({...n,role:a})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col grow",children:[e.jsx("p",{children:e.jsx("b",{children:n.user_name})}),e.jsx("p",{children:n.user_email}),e.jsxs("div",{children:[e.jsxs("select",{required:!0,onChange:i=>l(i.target.value),value:a,className:"text-black rounded-sm mr-2",children:[e.jsx("option",{disabled:!r,value:"owner",children:"Owner"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx(v,{color:"success",size:"small",disabled:o,"aria-disabled":o,onClick:c,children:"Tallenna"})]})]}),e.jsx(g,{color:"info",className:"h-full",children:e.jsx(h,{})})]})}function F({data:n,updateUser:s,currentUser:r}){return e.jsx("ul",{className:"text-white text-left",children:n.organization_users.map((a,l)=>{const o=a.role==="owner",c=a.user_email===r.email,i=o&&c;if(a.invitation){const d=new Date(a.created_at),m=j(a.created_at),u=j(new Date(d.setSeconds(d.getSeconds()+604800)));return e.jsxs("li",{className:"mt-2 p-2 pl-4 bg-primary-dark shadow-md rounded-md flex items-center",children:[e.jsxs("div",{className:"grow",children:[e.jsx("p",{children:e.jsx("b",{children:"Kutsu odottaa..."})}),e.jsx("p",{children:a.user_email}),e.jsx("p",{children:e.jsx("b",{children:a.role})}),e.jsx("p",{children:e.jsxs("i",{children:["Lähetetty ",m.date]})}),e.jsx("p",{children:e.jsxs("i",{children:["Vanhenee ",u.date]})})]}),e.jsx(g,{color:"info",className:"h-full",children:e.jsx(h,{})})]},l)}else return o||c?e.jsxs("li",{className:"mt-2 p-2 pl-4 bg-primary-main shadow-md rounded-md",children:[e.jsx("p",{children:e.jsxs("b",{children:[a.user_name," ",c?"(minä)":""]})}),e.jsx("p",{children:a.user_email}),e.jsx("p",{children:e.jsx("b",{children:a.role})})]},l):e.jsx("li",{className:"mt-2 p-2 pl-4 flex items-center bg-primary-main shadow-md rounded-md",children:e.jsx(A,{user:a,updateUser:s,imOwner:i})},l)})})}function T(){const{organization_id:n}=z(),{user:s}=U(),{data:r,isLoading:a,isError:l,refetch:o}=D({organization_id:n??"",token:(s==null?void 0:s.token)??""}),{mutate:c}=R(),[i,d]=f.useState({email:"",role:"user"});function m(t,_){c({organization_id:n??"",token:(s==null?void 0:s.token)??"",user_email:t,role:_},{onSuccess(){o()}})}function u(t){t.role==="owner"||m(t.user_email,t.role)}function b(t){t.preventDefault(),console.error("Need to implement confirmation"),m(i.email,i.role)}function p(t){d({...i,[t.target.name]:t.target.value})}return e.jsxs("section",{className:"m-auto max-w-xs bg-secondary-main p-2 rounded-lg",children:[e.jsx("h3",{className:"pt-2 pb-2",children:"Käyttäjät"}),e.jsxs("form",{onSubmit:b,children:[e.jsx("input",{required:!0,type:"email",id:"email",name:"email",value:i.email,onChange:p,placeholder:"käyttäjä@domain.fi",className:"w-full rounded-sm text-black p-1"}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsxs("select",{required:!0,id:"role",name:"role",value:i.role,onChange:p,className:"text-black rounded-sm p-1 grow",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx(v,{type:"submit",variant:"contained",color:"success",disableElevation:!0,children:"Lisää"})]})]}),l?e.jsx(S,{}):!a&&r?e.jsx(F,{data:r,updateUser:u,currentUser:{email:(s==null?void 0:s.user.email)??""}}):e.jsx(C,{})]})}function K(){return e.jsxs("main",{className:"m-auto mb-6 text-center",children:[e.jsx("h2",{className:"p-2",children:"Tilauksen ja tiimin hallinnointi sivu"}),e.jsx(T,{})]})}export{K as default};
