import{g as w,a as U,s as M,_ as c,r as g,u as D,b as R,L as S,j as s,c as A,d as H,e as k,f as ot,i as at,h as it,k as V,B as rt,l as ct,m as K,M as lt,P as q,n as y,o as W,p as dt,q as ut,t as pt}from"./index-87635f2d.js";import{u as mt}from"./useQuery-7105b008.js";function ft(t){return U("MuiListItem",t)}const gt=w("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]),b=gt,xt=w("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]),vt=xt;function ht(t){return U("MuiListItemSecondaryAction",t)}w("MuiListItemSecondaryAction",["root","disableGutters"]);const bt=["className"],yt=t=>{const{disableGutters:e,classes:n}=t;return H({root:["root",e&&"disableGutters"]},ht,n)},Ct=M("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.disableGutters&&e.disableGutters]}})(({ownerState:t})=>c({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})),Z=g.forwardRef(function(e,n){const o=D({props:e,name:"MuiListItemSecondaryAction"}),{className:l}=o,d=R(o,bt),i=g.useContext(S),a=c({},o,{disableGutters:i.disableGutters}),r=yt(a);return s.jsx(Ct,c({className:A(r.root,l),ownerState:a,ref:n},d))});Z.muiName="ListItemSecondaryAction";const jt=Z,It=["className"],Lt=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],kt=(t,e)=>{const{ownerState:n}=t;return[e.root,n.dense&&e.dense,n.alignItems==="flex-start"&&e.alignItemsFlexStart,n.divider&&e.divider,!n.disableGutters&&e.gutters,!n.disablePadding&&e.padding,n.button&&e.button,n.hasSecondaryAction&&e.secondaryAction]},St=t=>{const{alignItems:e,button:n,classes:o,dense:l,disabled:d,disableGutters:i,disablePadding:a,divider:r,hasSecondaryAction:m,selected:u}=t;return H({root:["root",l&&"dense",!i&&"gutters",!a&&"padding",r&&"divider",d&&"disabled",n&&"button",e==="flex-start"&&"alignItemsFlexStart",m&&"secondaryAction",u&&"selected"],container:["container"]},ft,o)},At=M("div",{name:"MuiListItem",slot:"Root",overridesResolver:kt})(({theme:t,ownerState:e})=>c({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!e.disablePadding&&c({paddingTop:8,paddingBottom:8},e.dense&&{paddingTop:4,paddingBottom:4},!e.disableGutters&&{paddingLeft:16,paddingRight:16},!!e.secondaryAction&&{paddingRight:48}),!!e.secondaryAction&&{[`& > .${vt.root}`]:{paddingRight:48}},{[`&.${b.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${b.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:k(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${b.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:k(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${b.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},e.alignItems==="flex-start"&&{alignItems:"flex-start"},e.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},e.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${b.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:k(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:k(t.palette.primary.main,t.palette.action.selectedOpacity)}}},e.hasSecondaryAction&&{paddingRight:48})),Nt=M("li",{name:"MuiListItem",slot:"Container",overridesResolver:(t,e)=>e.container})({position:"relative"}),Pt=g.forwardRef(function(e,n){const o=D({props:e,name:"MuiListItem"}),{alignItems:l="center",autoFocus:d=!1,button:i=!1,children:a,className:r,component:m,components:u={},componentsProps:f={},ContainerComponent:p="li",ContainerProps:{className:N}={},dense:j=!1,disabled:z=!1,disableGutters:P=!1,disablePadding:Q=!1,divider:Y=!1,focusVisibleClassName:J,secondaryAction:G,selected:X=!1,slotProps:tt={},slots:et={}}=o,st=R(o.ContainerProps,It),nt=R(o,Lt),_=g.useContext(S),$=g.useMemo(()=>({dense:j||_.dense||!1,alignItems:l,disableGutters:P}),[l,_.dense,j,P]),O=g.useRef(null);ot(()=>{d&&O.current&&O.current.focus()},[d]);const h=g.Children.toArray(a),E=h.length&&at(h[h.length-1],["ListItemSecondaryAction"]),I=c({},o,{alignItems:l,autoFocus:d,button:i,dense:$.dense,disabled:z,disableGutters:P,disablePadding:Q,divider:Y,hasSecondaryAction:E,selected:X}),F=St(I),B=it(O,n),L=et.root||u.Root||At,C=tt.root||f.root||{},x=c({className:A(F.root,C.className,r),disabled:z},nt);let v=m||"li";return i&&(x.component=m||"div",x.focusVisibleClassName=A(b.focusVisible,J),v=rt),E?(v=!x.component&&!m?"div":v,p==="li"&&(v==="li"?v="div":x.component==="li"&&(x.component="div")),s.jsx(S.Provider,{value:$,children:s.jsxs(Nt,c({as:p,className:A(F.container,N),ref:B,ownerState:I},st,{children:[s.jsx(L,c({},C,!V(L)&&{as:v,ownerState:c({},I,C.ownerState)},x,{children:h})),h.pop()]}))})):s.jsx(S.Provider,{value:$,children:s.jsxs(L,c({},C,{as:v,ref:B},!V(L)&&{ownerState:c({},I,C.ownerState)},x,{children:[h,G&&s.jsx(jt,{children:G})]}))})}),$t=Pt;function T(t){const e=new Date(t),n=e.toLocaleDateString("fi",{day:"2-digit",month:"2-digit",year:"2-digit",timeZone:"Europe/Helsinki"}),o=e.toLocaleTimeString("fi",{hour:"2-digit",minute:"2-digit",timeZone:"Europe/Helsinki"}).replace(".",":");return{date:n,time:o}}function Ot(t){return mt({queryKey:["invitations"],staleTime:1e3*60,queryFn:async()=>{const{data:e}=await K.get("/api/invitations/",{headers:{Authorization:t.token}});return e},onError(e){console.error("Error when fetching invitations: ",e)},onSuccess(e){console.log("Succesfully fetched invitations: ",e)}})}function Rt(){return ct({mutationFn:async({_id:t,token:e})=>{const{data:n}=await K.patch("/api/invitations/"+t,{},{headers:{Authorization:e}});return n}})}function wt(t){return s.jsx(lt,{open:t.open,onClose:t.onClose,className:"flex justify-center h-full",children:s.jsxs(q,{elevation:3,className:"m-auto p-6",children:[s.jsx("h2",{children:"Oletko varma"}),s.jsx("p",{children:t.message}),s.jsxs("div",{className:"flex justify-center gap-2 pt-2",children:[s.jsx(y,{color:"success",variant:"contained",onClick:t.callback,children:"Kyllä"}),s.jsx(y,{color:"error",onClick:t.onClose,children:"Peruuta"})]})]})})}function Mt(){const t=W(),e=t.user,{data:n,refetch:o}=Ot({token:e.token}),{mutate:l}=Rt(),[d,i]=g.useState(!1),a=n==null?void 0:n.map((u,f)=>{const p=new Date(u.createdAt),N=T(u.createdAt),j=T(new Date(p.setSeconds(p.getSeconds()+604800)));return s.jsxs(q,{elevation:3,className:"p-4",children:[s.jsx("h3",{children:u.organization.name}),s.jsxs("p",{children:["Käyttäjärooli: ",s.jsx("b",{children:u.role})]}),s.jsxs("p",{children:["Lähetetty: ",s.jsx("b",{children:N.date})]}),s.jsxs("p",{children:["Vanhenee: ",s.jsx("b",{children:j.date})," "]}),s.jsxs("div",{className:"flex justify-center gap-2 pt-2",children:[s.jsx(y,{color:"success",variant:"contained",onClick:()=>r(u._id),children:"Hyväksy"}),s.jsx(y,{color:"error",onClick:()=>{i(!0)},children:"Hylkää"})]})]},f)});function r(u){l({_id:u,token:e.token},{onSuccess(f){let p=e.user.organizations;p?p.push(f):p=[f],t.setUser({...e,user:{...e.user,organizations:p}}),o()},onError(f){console.error(f)}})}function m(){console.error("Not Implemented"),i(!1)}return s.jsxs(s.Fragment,{children:[s.jsx("section",{className:"grid gap-4 text-left",children:a}),s.jsx(wt,{open:d,onClose:()=>i(!1),callback:m,message:""})]})}function _t(){var i;const{user:t,organization:e,setOrganization:n}=W(),o=(i=t==null?void 0:t.user)==null?void 0:i.organizations,l=dt();g.useEffect(()=>{n(void 0)},[]);function d(a){if(o===void 0)return;const r=o[a].organization_id,m=o[a].organization_name;n({...e,_id:r,name:m}),l("/"+r)}return s.jsxs("main",{className:"m-auto text-center",children:[s.jsx("section",{className:"pt-6 text-white",children:s.jsx("h2",{children:"Valitse Seurakunta"})}),s.jsx("section",{className:"pt-6",children:s.jsx(ut,{dense:!0,sx:{width:"fit-content",margin:"auto"},children:o==null?void 0:o.map((a,r)=>s.jsx($t,{children:s.jsx(y,{color:"info",fullWidth:!0,variant:"contained",onClick:()=>d(r),children:s.jsx("h3",{children:a.organization_name})})},a.organization_id))})}),s.jsx("section",{className:"pt-6 flex flex-col w-fit m-auto justify-center gap-2",children:s.jsx(y,{color:"info",variant:"outlined",component:pt,to:"/create",children:s.jsx("h3",{children:"Luo uusi seurakunta"})})}),s.jsxs("section",{className:"pt-6 flex flex-col w-fit m-auto justify-center gap-2",children:[s.jsx("h3",{children:s.jsx("u",{children:"Kutsut"})}),s.jsx(Mt,{})]})]})}export{_t as default};
