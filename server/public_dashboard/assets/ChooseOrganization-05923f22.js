import{g as w,a as T,s as M,_ as c,r as g,u as D,b as R,L as A,j as e,c as S,d as K,e as k,f as ot,i as at,h as it,k as E,B as rt,l as ct,m as q,M as lt,P as H,n as y,o as W,p as dt,q as ut,t as pt}from"./index-d2cb6bc4.js";import{g as U}from"./formatDates-388d77ab.js";import{u as mt}from"./useQuery-c133b67d.js";function ft(t){return T("MuiListItem",t)}const gt=w("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]),h=gt,xt=w("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]),vt=xt;function bt(t){return T("MuiListItemSecondaryAction",t)}w("MuiListItemSecondaryAction",["root","disableGutters"]);const ht=["className"],yt=t=>{const{disableGutters:s,classes:n}=t;return K({root:["root",s&&"disableGutters"]},bt,n)},Ct=M("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.root,n.disableGutters&&s.disableGutters]}})(({ownerState:t})=>c({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})),Q=g.forwardRef(function(s,n){const o=D({props:s,name:"MuiListItemSecondaryAction"}),{className:l}=o,d=R(o,ht),i=g.useContext(A),a=c({},o,{disableGutters:i.disableGutters}),r=yt(a);return e.jsx(Ct,c({className:S(r.root,l),ownerState:a,ref:n},d))});Q.muiName="ListItemSecondaryAction";const jt=Q,It=["className"],Lt=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],kt=(t,s)=>{const{ownerState:n}=t;return[s.root,n.dense&&s.dense,n.alignItems==="flex-start"&&s.alignItemsFlexStart,n.divider&&s.divider,!n.disableGutters&&s.gutters,!n.disablePadding&&s.padding,n.button&&s.button,n.hasSecondaryAction&&s.secondaryAction]},At=t=>{const{alignItems:s,button:n,classes:o,dense:l,disabled:d,disableGutters:i,disablePadding:a,divider:r,hasSecondaryAction:m,selected:u}=t;return K({root:["root",l&&"dense",!i&&"gutters",!a&&"padding",r&&"divider",d&&"disabled",n&&"button",s==="flex-start"&&"alignItemsFlexStart",m&&"secondaryAction",u&&"selected"],container:["container"]},ft,o)},St=M("div",{name:"MuiListItem",slot:"Root",overridesResolver:kt})(({theme:t,ownerState:s})=>c({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!s.disablePadding&&c({paddingTop:8,paddingBottom:8},s.dense&&{paddingTop:4,paddingBottom:4},!s.disableGutters&&{paddingLeft:16,paddingRight:16},!!s.secondaryAction&&{paddingRight:48}),!!s.secondaryAction&&{[`& > .${vt.root}`]:{paddingRight:48}},{[`&.${h.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${h.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:k(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${h.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:k(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${h.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},s.alignItems==="flex-start"&&{alignItems:"flex-start"},s.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},s.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${h.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:k(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:k(t.palette.primary.main,t.palette.action.selectedOpacity)}}},s.hasSecondaryAction&&{paddingRight:48})),Nt=M("li",{name:"MuiListItem",slot:"Container",overridesResolver:(t,s)=>s.container})({position:"relative"}),Pt=g.forwardRef(function(s,n){const o=D({props:s,name:"MuiListItem"}),{alignItems:l="center",autoFocus:d=!1,button:i=!1,children:a,className:r,component:m,components:u={},componentsProps:f={},ContainerComponent:p="li",ContainerProps:{className:N}={},dense:j=!1,disabled:z=!1,disableGutters:P=!1,disablePadding:Y=!1,divider:J=!1,focusVisibleClassName:X,secondaryAction:G,selected:Z=!1,slotProps:tt={},slots:et={}}=o,st=R(o.ContainerProps,It),nt=R(o,Lt),_=g.useContext(A),$=g.useMemo(()=>({dense:j||_.dense||!1,alignItems:l,disableGutters:P}),[l,_.dense,j,P]),O=g.useRef(null);ot(()=>{d&&O.current&&O.current.focus()},[d]);const b=g.Children.toArray(a),F=b.length&&at(b[b.length-1],["ListItemSecondaryAction"]),I=c({},o,{alignItems:l,autoFocus:d,button:i,dense:$.dense,disabled:z,disableGutters:P,disablePadding:Y,divider:J,hasSecondaryAction:F,selected:Z}),B=At(I),V=it(O,n),L=et.root||u.Root||St,C=tt.root||f.root||{},x=c({className:S(B.root,C.className,r),disabled:z},nt);let v=m||"li";return i&&(x.component=m||"div",x.focusVisibleClassName=S(h.focusVisible,X),v=rt),F?(v=!x.component&&!m?"div":v,p==="li"&&(v==="li"?v="div":x.component==="li"&&(x.component="div")),e.jsx(A.Provider,{value:$,children:e.jsxs(Nt,c({as:p,className:S(B.container,N),ref:V,ownerState:I},st,{children:[e.jsx(L,c({},C,!E(L)&&{as:v,ownerState:c({},I,C.ownerState)},x,{children:b})),b.pop()]}))})):e.jsx(A.Provider,{value:$,children:e.jsxs(L,c({},C,{as:v,ref:V},!E(L)&&{ownerState:c({},I,C.ownerState)},x,{children:[b,G&&e.jsx(jt,{children:G})]}))})}),$t=Pt;function Ot(t){return mt({queryKey:["invitations"],staleTime:1e3*60,queryFn:async()=>{const{data:s}=await q.get("/api/invitations/",{headers:{Authorization:t.token}});return s},onError(s){console.error("Error when fetching invitations: ",s)},onSuccess(s){console.log("Succesfully fetched invitations: ",s)}})}function Rt(){return ct({mutationFn:async({_id:t,token:s})=>{const{data:n}=await q.patch("/api/invitations/"+t,{},{headers:{Authorization:s}});return n}})}function wt(t){return e.jsx(lt,{open:t.open,onClose:t.onClose,className:"flex justify-center h-full",children:e.jsxs(H,{elevation:3,className:"m-auto p-6",children:[e.jsx("h2",{children:"Oletko varma"}),e.jsx("p",{children:t.message}),e.jsxs("div",{className:"flex justify-center gap-2 pt-2",children:[e.jsx(y,{color:"success",variant:"contained",onClick:t.callback,children:"Kyllä"}),e.jsx(y,{color:"error",onClick:t.onClose,children:"Peruuta"})]})]})})}function Mt(){const{user:t,setUser:s}=W(),{data:n,refetch:o}=Ot({token:(t==null?void 0:t.token)??""}),{mutate:l}=Rt(),[d,i]=g.useState(!1),a=n==null?void 0:n.map((u,f)=>{const p=new Date(u.createdAt),N=U(u.createdAt),j=U(new Date(p.setSeconds(p.getSeconds()+604800)));return e.jsxs(H,{elevation:3,className:"p-4",children:[e.jsx("h3",{children:u.organization.name}),e.jsxs("p",{children:["Käyttäjärooli: ",e.jsx("b",{children:u.role})]}),e.jsxs("p",{children:["Lähetetty: ",e.jsx("b",{children:N.date})]}),e.jsxs("p",{children:["Vanhenee: ",e.jsx("b",{children:j.date})," "]}),e.jsxs("div",{className:"flex justify-center gap-2 pt-2",children:[e.jsx(y,{color:"success",variant:"contained",onClick:()=>r(u._id),children:"Hyväksy"}),e.jsx(y,{color:"error",onClick:()=>{i(!0)},children:"Hylkää"})]})]},f)});function r(u){l({_id:u,token:(t==null?void 0:t.token)??""},{onSuccess(f){if(!t)return;let p=t.user.organizations;p?p.push(f):p=[f],s({...t,user:{...t.user,organizations:p}}),o()},onError(f){console.error(f)}})}function m(){console.log("kyllä"),i(!1)}return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"grid gap-4 text-left",children:a}),e.jsx(wt,{open:d,onClose:()=>i(!1),callback:m,message:""})]})}function Ft(){var i;const{user:t,organization:s,setOrganization:n}=W(),o=(i=t==null?void 0:t.user)==null?void 0:i.organizations,l=dt();g.useEffect(()=>{n({})},[]);function d(a){if(o===void 0)return;const r=o[a].organization_id,m=o[a].organization_name;n({...s,_id:r,name:m}),l("/"+r)}return e.jsxs("main",{className:"w-full m-auto mb-6 text-center",children:[e.jsx("section",{className:"pt-6 text-white",children:e.jsx("h2",{children:"Valitse Seurakunta"})}),e.jsx("section",{className:"pt-6",children:e.jsx(ut,{dense:!0,sx:{width:"fit-content",margin:"auto"},children:o==null?void 0:o.map((a,r)=>e.jsx($t,{children:e.jsx(y,{color:"info",fullWidth:!0,variant:"contained",onClick:()=>d(r),children:e.jsx("h3",{children:a.organization_name})})},a.organization_id))})}),e.jsx("section",{className:"pt-6 flex flex-col w-fit m-auto justify-center gap-2",children:e.jsx(y,{color:"info",variant:"outlined",component:pt,to:"/create",children:e.jsx("h3",{children:"Luo uusi seurakunta"})})}),e.jsxs("section",{className:"pt-6 flex flex-col w-fit m-auto justify-center gap-2",children:[e.jsx("h3",{children:e.jsx("u",{children:"Kutsut"})}),e.jsx(Mt,{})]})]})}export{Ft as default};
