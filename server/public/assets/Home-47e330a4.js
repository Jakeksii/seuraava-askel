import{n as w,_ as m,E as v,F as y,G as _,H as b,r as h,I as D,j as e,L as E,J as R,z as p,D as M}from"./index-7d16c83c.js";import{Q as I,u as z,a as $,C,f as F,A as O,H as k}from"./Header-dc4127e8.js";import{u as L,d as q,a as A,b as j}from"./useFormatDate-d0d9c553.js";import{d as H}from"./LocationOn-f8a44eea.js";import"./App-ba5f9d11.js";var S=function(t){w(i,t);function i(r,a){return t.call(this,r,a)||this}var n=i.prototype;return n.bindMethods=function(){t.prototype.bindMethods.call(this),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)},n.setOptions=function(a,c){t.prototype.setOptions.call(this,m({},a,{behavior:v()}),c)},n.getOptimisticResult=function(a){return a.behavior=v(),t.prototype.getOptimisticResult.call(this,a)},n.fetchNextPage=function(a){var c;return this.fetch({cancelRefetch:(c=a==null?void 0:a.cancelRefetch)!=null?c:!0,throwOnError:a==null?void 0:a.throwOnError,meta:{fetchMore:{direction:"forward",pageParam:a==null?void 0:a.pageParam}}})},n.fetchPreviousPage=function(a){var c;return this.fetch({cancelRefetch:(c=a==null?void 0:a.cancelRefetch)!=null?c:!0,throwOnError:a==null?void 0:a.throwOnError,meta:{fetchMore:{direction:"backward",pageParam:a==null?void 0:a.pageParam}}})},n.createResult=function(a,c){var l,d,f,g,o,u,s=a.state,x=t.prototype.createResult.call(this,a,c);return m({},x,{fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:y(c,(l=s.data)==null?void 0:l.pages),hasPreviousPage:_(c,(d=s.data)==null?void 0:d.pages),isFetchingNextPage:s.isFetching&&((f=s.fetchMeta)==null||(g=f.fetchMore)==null?void 0:g.direction)==="forward",isFetchingPreviousPage:s.isFetching&&((o=s.fetchMeta)==null||(u=o.fetchMore)==null?void 0:u.direction)==="backward"})},i}(I);function Q(t,i,n){var r=b(t,i,n);return z(r,S)}function T(t){const[i,n]=h.useState(null),r=h.useRef();return{ref:h.useCallback(c=>{if(r.current&&(r.current.disconnect(),r.current=null),c===null){n(null);return}r.current=new IntersectionObserver(([l])=>{n(l)},t),r.current.observe(c)},[t==null?void 0:t.rootMargin,t==null?void 0:t.root,t==null?void 0:t.threshold]),entry:i}}function U(t){return Q({queryKey:["events",t.query],staleTime:1e3*60*5,queryFn:async({pageParam:i=1})=>{const{data:n}=await $.get("api/events"+t.query+"&page="+i);return n},onError(i){console.error("Error when fetching events: ",i)},onSuccess(i){console.log("Succesfully fetched events: ",i)},getNextPageParam(i,n){if(!(n.length===0||n[n.length-1].length===0))return n.length+1}})}function P(t){const i=new C(t.imageID,{cloudName:D}).resize(F().gravity("auto").width(450).height(300)),n=t.distance!=null?e.jsxs("div",{className:"flex w-fit items-center rounded-full bg-secondary-light p-1 mb-1",children:[e.jsx(H,{style:{color:"white"}}),e.jsxs("h6",{className:"p-1 text-white",children:[t.distance," km"]})]}):null,r=L(t.startDate,t.endDate),a=e.jsxs("div",{className:"flex items-center rounded-full bg-secondary-light p-1",children:[e.jsx(q,{style:{color:"white"}}),e.jsx("h6",{className:"p-1 text-white",children:r.startDate===r.endDate?r.startDate:r.startDate+"-"+r.endDate})]}),c=e.jsxs("div",{className:"flex items-center rounded-full bg-secondary-light p-1",children:[e.jsx(A,{style:{color:"white"}}),e.jsxs("h6",{className:"p-1 text-white",children:[r.startTime," - ",r.endTime]})]}),d=encodeURI(t.organization.replace(/\s/g,"-"))+"/"+t._id;return e.jsx("div",{className:"m-auto shadow-lg max-w-[350px] md:max-w-none md:w-auto rounded-2xl bg-white h-[100%] cursor-pointer mb-6",children:e.jsx(E,{to:d,children:e.jsxs("div",{className:"md:grid grid-flow-col grid-cols-[350px,1fr] rounded-2xl items-center",children:[e.jsx(O,{className:"rounded-2xl",cldImg:i}),e.jsxs("div",{className:"m-4",children:[n,t.organization,e.jsx("h2",{className:"text-black p-0",children:t.title}),e.jsxs("div",{className:"flex gap-2 pt-2 pb-2",children:[a,c]}),e.jsx("p",{className:"text-black",children:t.extract}),e.jsx("br",{})]})]})})})}const N=e.jsx("div",{className:"grid justify-center pt-4","aria-busy":!0,children:e.jsx(M,{size:50,color:"info"})});function B(){const t=R(),i=p(),{isLoading:n,data:r,isError:a,fetchNextPage:c,isFetchingNextPage:l,hasNextPage:d}=U({query:t.query,page:1}),f=h.useRef(null),{ref:g,entry:o}=T({root:f.current,threshold:0});return h.useEffect(()=>{o!=null&&o.isIntersecting&&d&&c()},[o]),n?N:a?e.jsx("div",{children:e.jsx("h2",{className:"text-center pt-4",children:"Error when fetching events. Please try again"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:r==null?void 0:r.pages.map(u=>u.map((s,x)=>u.length-1===x?e.jsx("div",{ref:g,children:e.jsx(P,{_id:s._id,imageID:s.image_id,title:s.title,extract:s.extract,organization:s.organization.organization_name,distance:i.coords.latitude?Math.round(j(i.coords.longitude,i.coords.latitude,s.address.coordinates[0],s.address.coordinates[1])):null,startDate:s.start_date,endDate:s.end_date})},s._id):e.jsx("div",{children:e.jsx(P,{_id:s._id,imageID:s.image_id,title:s.title,extract:s.extract,organization:s.organization.organization_name,distance:i.coords.latitude?Math.round(j(i.coords.longitude,i.coords.latitude,s.address.coordinates[0],s.address.coordinates[1])):null,startDate:s.start_date,endDate:s.end_date})},s._id)))}),e.jsx("div",{className:"w-[100%]",children:l?N:e.jsx("div",{className:"h-1 rounded-sm m-6 bg-slate-400"})})]})}function W(){return e.jsxs(e.Fragment,{children:[e.jsx(k,{home:!0}),e.jsx("main",{children:e.jsx("section",{className:"pt-6",children:e.jsx(B,{})})}),e.jsx("footer",{children:e.jsx("div",{className:" pb-16"})})]})}export{W as default};
