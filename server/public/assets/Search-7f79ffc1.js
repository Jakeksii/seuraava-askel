import{r as d,t as re,v as se,o as ae,p as V,_ as h,J as le,x as ue,y as Y,K as ie,j as l,z as ce,A as de,M as pe,N as fe,O as me,a as he,P as xe,Q as ge,R as Ce,m as ye,T as be,U as Re}from"./index-cfe8efc0.js";import{u as ve}from"./useQuery-f7b73c4e.js";const Pe=d.createContext(void 0),we=Pe;function Ee(){return d.useContext(we)}function Se(a){return re("MuiInput",a)}se("MuiInput",["root","formControl","focused","disabled","error","multiline","input","inputMultiline","inputTypeSearch","adornedStart","adornedEnd"]);function Fe(a){const{defaultValue:r,disabled:f=!1,error:i=!1,onBlur:c,onChange:u,onFocus:v,required:C=!1,value:w,inputRef:m}=a,e=Ee();let P,p,x,y,t;if(e){var b,R,T;P=void 0,p=(b=e.disabled)!=null?b:!1,x=(R=e.error)!=null?R:!1,y=(T=e.required)!=null?T:!1,t=e.value}else P=r,p=f,x=i,y=C,t=w;const{current:N}=d.useRef(t!=null),_=d.useCallback(n=>{},[]),E=d.useRef(null),j=ae(E,m,_),[S,F]=d.useState(!1);d.useEffect(()=>{!e&&p&&S&&(F(!1),c==null||c())},[e,p,S,c]);const k=n=>s=>{var o;if(e!=null&&e.disabled){s.stopPropagation();return}if((o=n.onFocus)==null||o.call(n,s),e&&e.onFocus){var g;e==null||(g=e.onFocus)==null||g.call(e)}else F(!0)},B=n=>s=>{var o;(o=n.onBlur)==null||o.call(n,s),e&&e.onBlur?e.onBlur():F(!1)},A=n=>(s,...o)=>{var g,I;if(!N&&(s.target||E.current)==null)throw new Error(le(17));e==null||(g=e.onChange)==null||g.call(e,s),(I=n.onChange)==null||I.call(n,s,...o)},q=n=>s=>{var o;E.current&&s.currentTarget===s.target&&E.current.focus(),(o=n.onClick)==null||o.call(n,s)};return{disabled:p,error:x,focused:S,formControlContext:e,getInputProps:(n={})=>{const o=h({},{onBlur:c,onChange:u,onFocus:v},V(n)),g=h({},n,o,{onBlur:B(o),onChange:A(o),onFocus:k(o)});return h({},g,{"aria-invalid":x||void 0,defaultValue:P,ref:j,value:t,required:y,disabled:p})},getRootProps:(n={})=>{const s=V(a,["onBlur","onChange","onFocus"]),o=h({},s,V(n));return h({},n,o,{onClick:q(o)})},inputRef:j,required:y,value:t}}const Te=["aria-describedby","aria-label","aria-labelledby","autoComplete","autoFocus","className","defaultValue","disabled","endAdornment","error","id","multiline","name","onClick","onChange","onKeyDown","onKeyUp","onFocus","onBlur","placeholder","readOnly","required","startAdornment","value","type","rows","slotProps","slots","minRows","maxRows"],je=a=>{const{disabled:r,error:f,focused:i,formControlContext:c,multiline:u,startAdornment:v,endAdornment:C}=a;return ce({root:["root",r&&"disabled",f&&"error",i&&"focused",!!c&&"formControl",u&&"multiline",!!v&&"adornedStart",!!C&&"adornedEnd"],input:["input",r&&"disabled",u&&"multiline"]},de(Se))},Ie=d.forwardRef(function(r,f){var i,c,u;const{"aria-describedby":v,"aria-label":C,"aria-labelledby":w,autoComplete:m,autoFocus:e,className:P,defaultValue:p,disabled:x,endAdornment:y,error:t,id:b,multiline:R=!1,name:T,onClick:N,onChange:_,onKeyDown:E,onKeyUp:j,onFocus:S,onBlur:F,placeholder:k,readOnly:B,required:A,startAdornment:q,value:K,type:H,rows:n,slotProps:s={},slots:o={},minRows:g,maxRows:I}=r,O=ue(r,Te),{getRootProps:z,getInputProps:G,focused:Q,formControlContext:J,error:Z,disabled:X}=Fe({disabled:x,defaultValue:p,error:t,onBlur:F,onClick:N,onChange:_,onFocus:S,required:A,value:K}),$=R?void 0:H??"text",L=h({},r,{disabled:X,error:Z,focused:Q,formControlContext:J,multiline:R,type:$}),D=je(L),ee={"aria-describedby":v,"aria-label":C,"aria-labelledby":w,autoComplete:m,autoFocus:e,id:b,onKeyDown:E,onKeyUp:j,name:T,placeholder:k,readOnly:B,type:$},M=(i=o.root)!=null?i:"div",te=Y({elementType:M,getSlotProps:z,externalSlotProps:s.root,externalForwardedProps:O,additionalProps:{ref:f},ownerState:L,className:[D.root,P]}),U=R?(c=o.textarea)!=null?c:"textarea":(u=o.input)!=null?u:"input",ne=Y({elementType:U,getSlotProps:oe=>G(h({},ee,oe)),externalSlotProps:s.input,additionalProps:h({rows:R?n:void 0},R&&!ie(U)&&{minRows:n||g,maxRows:n||I}),ownerState:L,className:D.input});return l.jsxs(M,h({},te,{children:[q,l.jsx(U,h({},ne)),y]}))}),Ne=Ie;function W(a,r){var f=a.split(new RegExp(`(${r})`,"gi"));return f.map((i,c)=>l.jsx(d.Fragment,{children:i.toLowerCase()===r.toLowerCase()?l.jsx("b",{className:"bg-secondary-main text-white rounded-sm",children:i}):i},c))}function _e(a){switch(a){case me:return"Kaupunki";case fe:return"Seurakunta";case pe:return"Tapahtuma";default:return""}}function ke(a){return ve({queryKey:["search-results",a.query],enabled:a.enabled,staleTime:1e3*60,queryFn:async()=>{const{data:r}=await he.get("/api/events/search?search="+a.query);return r},onError(r){console.error("Error when fetching search results: ",r)},onSuccess(r){console.log("Succesfully fetched search results: ",r)}})}function qe(a){const r=xe(),f=d.useRef(null),[i,c]=d.useState(!0),[u,v]=d.useState("");let C;const{isLoading:w,data:m,isError:e}=ke({query:encodeURI(u.replace(/\s+/g," ").trim()),enabled:!i&&u.length>=3});d.useEffect(()=>(i&&u.length>=3&&(C=setTimeout(()=>{c(!1)},500)),()=>{clearTimeout(C)}),[i,u]);const P=t=>{v(t.target.value),i||c(!0)};function p(){var t;(t=f.current)==null||t.select()}const x=t=>{const b="?s="+t.data+"&type="+t.type;r.setValues({...r.values,query:b,search:t.data}),a.close()},y=()=>{if(w)return l.jsx(ye,{size:40});if(e)return l.jsxs("h5",{className:"pt-2 text-center text-info-main",children:[" ",be," "]},0);if(m&&m.length===0)return l.jsxs("h5",{className:"pt-2 text-center text-info-main",children:[" ",W(u,u)," "," ei tuottanut tuloksia."," "]},0);if(m)return l.jsx("ul",{children:m.map((t,b)=>l.jsx("li",{className:"pb-1",children:l.jsx(Re,{variant:"contained",color:"info",fullWidth:!0,onClick:()=>x(t),children:l.jsxs("div",{className:"flex flex-col md:flex-row",children:[l.jsx("p",{className:"pl-1 pr-1 text-primary-main",children:_e(t.type)}),l.jsx("p",{className:"text-primary-main",children:W(t.data,u)})]})})},b))})};return l.jsxs(ge,{children:[l.jsxs("section",{onClick:p,className:"mb-2 w-full flex justify-center items-center p-3 rounded-lg text-info-main shadow-md bg-secondary-main",children:[l.jsx(Ce,{color:"info"}),l.jsx(Ne,{onFocus:p,className:"w-full pl-1",slotProps:{input:{autoFocus:!0,ref:f,className:"bg-transparent outline-0 w-full placeholder-[#f5cca8] rounded-sm"}},"aria-label":"search",placeholder:"Etsi tapahtumia...",onChange:P,value:u,onKeyDown:t=>{t.key==="Enter"&&m&&x(m[0])}})]}),y()]})}export{qe as default};
